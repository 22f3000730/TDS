
name: CI Matrix Build with Artifacts - a77a20c

# Trigger on pushes and pull requests (adjust as needed)
on:
  push:
  pull_request:

jobs:
  build:
    name: Build on ${{ matrix.os }} - Node ${{ matrix.node }}
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]
        node: [14, 16, 18]

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: matrix-a77a20c
        # This step contains the required identifier in its name.
        run: |
          echo "Matrix job starting: OS=${{ matrix.os }} NODE=${{ matrix.node }}"

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ matrix.node }}

      - name: Verify Node (optional)
        run: |
          node -v
          npm -v

      - name: Generate build artifact
        # Use env to pass matrix values reliably to the node script (cross-platform)
        env:
          MATRIX_OS: ${{ matrix.os }}
          MATRIX_NODE: ${{ matrix.node }}
        run: |
          node -e "const fs=require('fs'); const content = [
            `build-id: build-a77a20c-${process.env.MATRIX_OS}-node${process.env.MATRIX_NODE}`,
            `timestamp: ${new Date().toISOString()}`,
            `os: ${process.env.MATRIX_OS}`,
            `node: ${process.env.MATRIX_NODE}`,
            'note: artifact created by GitHub Actions matrix job'
          ].join('\\n'); fs.writeFileSync('build-info.txt', content); console.log(content);"

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          # Artifact name uses the required prefix
          name: build-a77a20c-${{ matrix.os }}-node${{ matrix.node }}
          path: build-info.txt

